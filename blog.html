<!doctype html>
<html lang="en">
	<head>
		<link rel="stylesheet" href="styles/firstStyle.css">
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
		<meta charset="UTF-8">
		<title>Welcome to Famtrees</title>
	</head>

	<body onload="init()">
    <script>
        var inputHandle;

		function init(){
			document.cookie.split(";").forEach(function(sub){if (sub.includes('handle')){inputHandle = sub.split('=')[1];}});
			if(inputHandle == undefined){document.getElementById("welcome").innerHTML = "Hey you gotta log in!"
			  return;
			}
			document.getElementById("welcome").innerHTML = "Hey " + inputHandle + " why don't you write on my webwall, thank you!!!";
		}
        function blogData(){
            var xhttp = new XMLHttpRequest();
            var message = document.getElementById("txt").elements[0].value;
	    if(message.length < 1){
		document.getElementById("response").innerHTML = "What's going on? you need to put some text in that box!";
		return;
	    }
	    else if(inputHandle == undefined){
	    	document.getElementById("response").innerHTML = "Sign on or register before you add to the blog though!"
		return;	    
	    }
            xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					document.getElementById("response").innerHTML = this.responseText;
					document.getElementById("txt").elements[0].value = '';
				}
			}
            xhttp.open("POST", "/addBlog", true);
            xhttp.setRequestHeader("Content-type", "application/json");
            xhttp.send(JSON.stringify({handle : inputHandle, txtBlog : message}));            
        }
       
    </script>
    
	<div>
	<nav class="navbar navbar-inverse" role="navigation">
		<ul class="nav navbar-nav">		
		<li class="active"><a href="/">Home<span class="sr-only"></span></a></li>
		<li class="active"><a href="/addUser">Register<span class="sr-only"></span></a></li>
		<li class="active"><a href="/blog">Blog<span class="sr-only">(current)</span></a></li>
		</ul>
	</nav>
	</div>

	<br/>
	
	<div class="jumbotron jumbotron-blog"> 
		 <form onsubmit="return false;" id="input" class="input txt">
			<table>
				<tr>
					<td><p id="welcome"></p></td>				
				</tr>
				<tr>
					<td><textarea id="blog" rows="13" cols="77"></textarea></td>
				</tr>
				<tr>
					<td colspan="2"><button onclick="blogData()">Add Blog</button></td>
				</tr>
			</table>
			<p id="response"></p>
		 </form>
		
		<div
		  class="fb-like"
		  data-share="true"
		  data-width="450"
		  data-show-faces="true">
		</div>
	</div>
	</body>
</html>
